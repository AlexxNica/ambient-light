<!DOCTYPE html>
<html>
  <head>
    <title>Ambient Light Events</title>
    <meta charset="utf-8"/>
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common' class='remove' async></script>
    <script class="remove">
      var respecConfig = {
          specStatus:           "ED",
          shortName:            "ambient-light",
          //publishDate:          "2012-12-13",
          previousPublishDate:  "2012-12-13",
          previousMaturity:     "LC",
          edDraftURI:           "http://dvcs.w3.org/hg/dap/raw-file/tip/light/Overview.html",
          lcEnd:                "2013-01-26",
          editors:  [
              { name: "Doug Turner", company: "Mozilla Corporation", companyURL: "http://mozilla.com/" },
              { name: "Anssi Kostiainen", company: "Nokia", companyURL: "http://nokia.com/" }
          ],
          inlineCSS:    true,
          noIDLIn:      true,
          noLegacyStyle: true,
          wg:           "Device APIs Working Group",
          wgURI:        "http://www.w3.org/2009/dap/",
          wgPublicList: "public-device-apis",
          wgPatentURI:  "http://www.w3.org/2004/01/pp-impl/43696/status",
      };
    </script>
  </head>
  <body>
    <section id="abstract">
      This specification defines a means to receive events that correspond to
      a light sensor detecting the presence of a light.
    </section>
    
    <section id="sotd">
      <p>
        The functionality described in this specification was initially
        specified as part of the
        <a href="http://dvcs.w3.org/hg/dap/raw-file/tip/sensor-api/Overview.html">
        Sensor API</a> but has been extracted in order to be more
        straightforward to implement, and in order to produce a specification
        that could be implemented on its own merits without interference with
        other features.
      </p>
      <p>
        Changes in this document since the previously published First Public Working Draft
        include the addition of the Light Level section with the LightLevelEvent interface,
        editorial cleanup, and an update to the references.
      </p>
    </section>
    
    <section class="informative">
      <h2>Introduction</h2>
      <p>
        This specification defines events that provide information about the
        ambient light level, as measured by a device's light sensor.  A
        <a>LightLevelEvent</a> describes the light level as one of three simple
        categories - "dim", "normal", and "bright" - while a
        <a>DeviceLightEvent</a> provides a more granular answer by describing
        the light level in terms of lux units.
      </p>
    </section>
    
    <section id="conformance">
      <p>
        This specification defines conformance criteria that apply to a single
        product: the <dfn>user agent</dfn> that implements the
        interfaces that it contains.
      </p>
    </section>
    
    <section>
      <h2>Terminology</h2>
      <p>
        The <code><a href="http://dev.w3.org/html5/spec/webappapis.html#eventhandler">
        EventHandler</a></code> interface represents a <a href="http://www.w3.org/TR/WebIDL/#idl-callback-functions">callback function</a> used for <a href="http://dev.w3.org/html5/spec/webappapis.html#event-handlers">event
      handlers</a> as defined in [[!HTML5]]. </p>
      <p>
        The concepts <dfn><a href="http://dev.w3.org/html5/spec/webappapis.html#queue-a-task">
        queue a task</a></dfn>,
        <dfn><a href="http://dev.w3.org/html5/spec/webappapis.html#fire-a-simple-event">
        fires a simple event</a></dfn>, and <dfn>
        <a href="http://dev.w3.org/html5/spec/browsers.html#browsing-context">
        browsing context</a></dfn> are defined in [[!HTML5]].
      </p>
      <p>
        The terms <dfn><a href="http://dev.w3.org/html5/spec/webappapis.html#event-handlers">
        event handlers</a></dfn> and
        <dfn><a href="http://dev.w3.org/html5/spec/webappapis.html#event-handler-event-type">
        event handler event types</a></dfn> are defined in [[!HTML5]].
      </p>
      <p>
        The concepts <dfn>
        <a href="http://dom.spec.whatwg.org/#constructing-events">
        create an event</a></dfn> and <dfn>
        <a href="http://dom.spec.whatwg.org/#firing-events">
        fire an event</a></dfn> are defined in [[!DOM4]].
      </p>
      <p>
        The <dfn>current light level</dfn> is a value that represents the ambient
        light levels around the hosting device in lux units.
      </p>
      <p>
        The <dfn>current light level state</dfn> represents the ambient light level
        around the hosting device as a human-readable string.
      </p>
    </section>
    
    <section>
      <h2>Security and privacy considerations</h2>
      <p>
      </p>
    </section>
    
    <section>
      <h2>Device Light</h2>
      <p>
        The <a>DeviceLightEvent</a> interface provides information about the
        ambient light levels, as detected by the device's light detector, in
        terms of lux units.
      </p>
      <p>
        The HTML5 specification [[!HTML5]] defines a <a>Window</a> interface,
        which this specification extends:
      </p>
      <dl title="partial interface Window" class="idl">
        <dt>attribute EventHandler ondevicelight</dt>
        <dd>
        </dd>
      </dl>
      <p>
        The <code>ondevicelight</code> event handler and its corresponding
        event handler event type <code>devicelight</code> MUST be supported
        as an IDL attribute by all objects implementing the <a>Window</a>
        interface.
      </p>
      <section>
        <h2><a>DeviceLightEvent</a> Interface</h2>
        <dl title="[Constructor (DOMString type, optional DeviceLightEventInit eventInitDict)]
                   interface DeviceLightEvent : Event"
            class="idl" data-merge='DeviceLightEventInit'>
          <dt>readonly attribute double value</dt>
          <dd>
            The <a>ambient light level in lux</a>.
          </dd>
        </dl>
        <dl title="dictionary DeviceLightEventInit : EventInit" class='idl'>
          <dt>
            double value
          </dt>
          <dd></dd>
        </dl>
        <p>
          The <code>value</code> attribute of the <a>DeviceLightEvent</a>
          interface MUST return the value it was initialized to. When the
          object is created, this attribute MUST be initialized to positive
          Infinity. It represents the <a>current light level</a>.
        </p>
        <div class="note">
          The precise lux value reported by different devices in the same light
          can be different, due to differences in detection method, sensor
          construction etc.
        </div>
        <p>
          When a <dfn>user agent</dfn> is required to <dfn>fire a device
          light event</dfn>, the <dfn>user agent</dfn> MUST run the
          following steps:
        </p>
        <ol class="rule">
          <li>
            <a>Create an event</a> that uses the <a>DeviceLightEvent</a>
            interface, with the name <code>devicelight</code>, which
            bubbles, is not cancelable, and has no default action, that also
            meets the following conditions:
            <ol>
              <li>
                If the implementation is unable to report the <a>current
                light level</a>, initialize the <code>value</code>
                attribute to positive Infinity, otherwise initialize the
                attribute to the <a>current light level</a>.
              </li>
            </ol>
          </li>
        </ol>
        <p>
          When the <a>current light level</a> changes, the <dfn>user agent</dfn>
          MUST queue a task to <a>fire a device light event</a>
          at each <a>browsing context</a>'s <a>Window</a> object.
        </p>
        <div class="note">
          The definition of granularity i.e. how often the event is fired is
          left to the implementation. Implementations can fire the event if
          they have reason to believe that the page does not have sufficiently
          fresh data.
        </div>
        <section>
          <h2>Event handlers</h2>
          <p>
            The following are the <a>event handlers</a> (and their corresponding
            <a>event handler event types</a>) that MUST be supported as
            attributes by the <a>Window</a> object:
          </p>
          <table class="simple">
            <thead>
              <tr>
                <th>event handler</th>
                <th>event handler event type</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong><code>ondevicelight</code></strong></td>
                <td><code>devicelight</code></td>
              </tr>
            </tbody>
          </table>
        </section>
      </section>
    </section>

    <section>
      <h2>Light Level</h2>
      <p>
        The <a>LightLevelEvent</a> interface provides information about the
        ambient light levels, as detected by the device's light detector, in
        terms of three general range: "dim", "normal", or "bright".
      </p>
      <p>
        The HTML5 specification [[!HTML5]] defines a <a>Window</a> interface,
        which this specification extends:
      </p>
      <dl title="partial interface Window" class="idl">
        <dt>attribute EventHandler onlightlevel</dt>
        <dd>
        </dd>
      </dl>
      <p>
        The <code>onlightlevel</code> event handler and its corresponding
        event handler event type <code>lightlevel</code> MUST be supported
        as an IDL attribute by all objects implementing the <a>Window</a>
        interface.
      </p>
      <section>
        <h2><a>LightLevelEvent</a> Interface</h2>
        <dl title="[Constructor (DOMString type, optional LightLevelEventInit eventInitDict)]
                   interface LightLevelEvent : Event"
            class="idl" data-merge='LightLevelEventInit LightLevelState'>
          <dt>readonly attribute LightLevelState value</dt>
          <dd></dd>
        </dl>
        <dl id="enum-basic" class="idl" title="enum LightLevelState">
          <dt>&zwj;</dt><!-- (empty string) -->
          <dd>
          </dd>
          <dt>dim</dt>
          <dd>
          </dd>
          <dt>normal</dt>
          <dd>
          </dd>
          <dt>bright</dt>
          <dd>
          </dd>
        </dl>
        <dl title="dictionary LightLevelEventInit : EventInit" class='idl'>
          <dt>
            LightLevelState value
          </dt>
          <dd></dd>
        </dl>
        <p>
          The <code>value</code> attribute of the <a>LightLevelEvent</a>
          interface MUST return the value it was initialized to. When the
          object is created, this attribute MUST be initialized to positive
          Infinity. It represents the <a>current light level state</a>.
        </p>
        <p>
          When a <dfn>user agent</dfn> is required to <dfn>fire a light
          level event</dfn>, the <dfn>user agent</dfn> MUST run the
          following steps:
        </p>
        <ol class="rule">
          <li>
            <a>Create an event</a> that uses the <a>LightLevelEvent</a>
            interface, with the name <code>lightlevel</code>, which
            bubbles, is not cancelable, and has no default action, that also
            meets the following conditions:
            <ol>
              <li>
                If the implementation is unable to report the <a>current
                light level state</a>, initialize the <code>value</code>
                attribute to empty string, otherwise initialize the
                attribute to the <a>current light level state</a>, which MUST
                be one of the following values:
                <ul>
                  <li><code>dim</code></li>
                  <li><code>normal</code></li>
                  <li><code>bright</code></li>
                </ul>
                <div class="note">
                  The lux ranges that map to the <a>current light level
                  state</a>s are left to the implementation, as devices with
                  different sensitivities could map them slightly differently.
                  However, it is recommended that "<code>dim</code>" correspond
                  to ambient light below 50 lux (dark enough that the light
                  produced by a white background is eye-straining or
                  distracting), "<code>normal</code>" correspond to light
                  between 50 lux and 10000 lux (office building hallway, very
                  dark overcast day, office lighting, sunrise or sunset on a
                  clear day, overcast day, or similar), and
                  "<code>bright</code>" correspond to light above 10000 lux
                  (direct sunlight, or similarly bright conditions that make it
                  hard to see things that aren't high-contrast).
                </div>
              </li>
            </ol>
          </li>
        </ol>
        <p>
          When the <a>current light level state</a> changes, the <dfn>user agent</dfn>
          MUST queue a task to <a>fire a user proximity event</a>
          at each <a>browsing context</a>'s <a>Window</a> object.
        </p>
        
        <div class="note">
          The definition of granularity i.e. how often the event is fired is
          left to the implementation. Implementations can fire the event if
          they have reason to believe that the page does not have sufficiently
          fresh data.
        </div>
        <section>
          <h2>Event handlers</h2>
          <p>
            The following are the <a>event handlers</a> (and their corresponding
            <a>event handler event types</a>) that MUST be supported as
            attributes by the <a>Window</a> object:
          </p>
          <table class="simple">
            <thead>
              <tr>
                <th>event handler</th>
                <th>event handler event type</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong><code>onlightlevel</code></strong></td>
                <td><code>lightlevel</code></td>
              </tr>
            </tbody>
          </table>
        </section>
      </section>
    </section>
      
    <section class="appendix">
      <h2>Acknowledgements</h2>
      <p>
        Doug Turner for the <a href="http://dougturner.wordpress.com/2012/03/26/device-light-sensor/">initial prototype</a> and
        Marcos Caceres for the test suite.
      </p>
    </section>
  </body>
</html>
